import{d as J,m as Q,n as W,u as X,L as Z,r as h,a as T,p as ee,C as te,I as se,k as le,c as r,b as t,E as y,e as a,w as n,_ as g,f as D,M as ae,F as k,y as q,j as f,i as oe,t as u,A as re,G as ne,g as x,h as j,N as A,B as ie,o,O as de}from"./index-CQ0vSrWa.js";import{_ as ue}from"./BaseCard.vue_vue_type_script_setup_true_lang-B-bdGHi1.js";import{_ as ce}from"./BaseInput.vue_vue_type_script_setup_true_lang-A9umqBxa.js";const me={class:"space-y-6"},fe={class:"md:flex md:items-center md:justify-between"},ve={class:"mt-4 flex md:mt-0 md:ml-4"},_e={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},pe={class:"block text-sm font-medium text-gray-700 mb-2"},ye={key:0,class:"mt-1 text-sm text-red-600"},ge={key:1,class:"mt-1 text-sm text-yellow-600"},xe={key:0,class:"mt-1 text-sm text-red-600"},be={class:"flex justify-between items-center mb-4"},he={key:0,class:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg"},De={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},we=["onClick"],ke={class:"flex items-start space-x-3"},Ie=["src","alt"],Ce={key:1,class:"w-16 h-24 bg-gray-200 rounded flex items-center justify-center"},Se={class:"flex-1 min-w-0"},$e={class:"text-sm font-medium text-gray-900 truncate"},Me={class:"text-sm text-gray-500"},Ve={class:"text-xs text-gray-400"},Ye={key:2,class:"mt-2 text-sm text-red-600"},Ne={class:"flex justify-end space-x-3"},Te={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"},qe={class:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto"},je={class:"p-6"},Ee={class:"flex justify-between items-center mb-6"},Pe={class:"mb-6"},Ae={class:"flex space-x-4"},Be={class:"flex-1"},Fe={key:0,class:"text-center py-8"},Re={key:1,class:"text-center py-8"},Le={key:2,class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 max-h-96 overflow-y-auto"},Oe={class:"flex items-start space-x-3"},ze=["src","alt"],Ke={key:1,class:"w-12 h-18 bg-gray-200 rounded flex items-center justify-center"},Ue={class:"flex-1 min-w-0"},Ge={class:"text-sm font-medium text-gray-900 truncate"},He={class:"text-sm text-gray-500"},Ze=J({__name:"RentalCreateView",setup(Je){const E=le(),I=se(),C=Q(),B=W(),F=X(),S=Z(),$=h(!1),M=h(!1),w=h(!1),d=h([]),v=h([]),c=T({clientId:"",returnDate:""}),_=T({query:"",hasSearched:!1}),i=T({clientId:"",returnDate:"",movies:""});function R(l){return l.getTime()<Date.now()+1440*60*1e3}const V=ee(()=>C.activeClients);te(async()=>{C.clients.length===0&&C.loadClients();const l=new Date;l.setDate(l.getDate()+1),c.returnDate=l.toISOString().split("T")[0];const e=I.query.movieId,m=I.query.movieTitle,N=I.query.movieYear;if(e&&m)try{const b={imdbID:e,Title:m,Year:N||"",Type:"movie",Poster:""};d.value=[b],S.showSuccess(`Filme "${m}" pré-selecionado para locação`),E.replace({path:"/rentals/create",query:{}})}catch(b){console.error("Erro ao pré-selecionar filme:",b),S.showError("Erro ao pré-selecionar filme")}});function L(){i.clientId="",i.returnDate="",i.movies="";let l=!0;return c.clientId||(i.clientId="Selecione um cliente",l=!1),c.returnDate||(i.returnDate="Data de devolução é obrigatória",l=!1),d.value.length===0&&(i.movies="Selecione pelo menos um filme",l=!1),l}async function O(){if(L())try{$.value=!0;const l={clientId:c.clientId,movieIds:d.value.map(m=>m.imdbID),rentalDate:new Date,returnDate:new Date(c.returnDate),userId:F.user.id};await B.createRental(l)&&await E.push("/rentals")}catch(l){console.error("Erro ao criar locação:",l)}finally{$.value=!1}}async function P(){if(_.query.trim())try{w.value=!0,_.hasSearched=!0;const l=await de.searchMovies({search:_.query,year:"",page:1});l.Response==="True"?v.value=l.Search||[]:v.value=[]}catch(l){console.error("Erro na busca de filmes:",l),l instanceof Error&&l.message.includes("Chave da API OMDb não configurada")&&S.showError("Chave da API OMDb não configurada. Crie um arquivo .env na raiz do projeto com VITE_OMDB_API_KEY=sua_chave_aqui"),v.value=[]}finally{w.value=!1}}function z(l){Y(l.imdbID)||d.value.push(l)}function K(l){const e=d.value.findIndex(m=>m.imdbID===l);e>-1&&d.value.splice(e,1)}function Y(l){return d.value.some(e=>e.imdbID===l)}function U(l){return l.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")}return(l,e)=>{const m=D("el-option"),N=D("el-select"),b=D("router-link"),G=D("el-date-picker"),p=D("el-icon");return o(),r(k,null,[t("div",me,[t("div",fe,[e[8]||(e[8]=t("div",{class:"flex-1 min-w-0"},[t("h2",{class:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate"}," Nova Locação "),t("p",{class:"mt-1 text-sm text-gray-500"}," Crie uma nova locação selecionando cliente e filmes. ")],-1)),t("div",ve,[a(g,{variant:"outline",onClick:e[0]||(e[0]=s=>l.$router.push("/rentals"))},{default:n(()=>e[7]||(e[7]=[f(" Voltar ")])),_:1,__:[7]})])]),a(ue,null,{default:n(()=>[t("form",{onSubmit:oe(O,["prevent"]),class:"space-y-6"},[t("div",_e,[t("div",null,[t("label",pe," Cliente * ("+u(V.value.length)+" disponíveis) ",1),a(N,{modelValue:c.clientId,"onUpdate:modelValue":e[1]||(e[1]=s=>c.clientId=s),placeholder:"Selecione um cliente",class:re([i.clientId?"border-red-300":"","w-full"])},{default:n(()=>[(o(!0),r(k,null,q(V.value,s=>(o(),ne(m,{key:s.id,label:`${s.name} ${s.lastName} (${U(s.cpf)})`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"]),i.clientId?(o(),r("p",ye,u(i.clientId),1)):y("",!0),V.value.length===0?(o(),r("p",ge,[e[10]||(e[10]=f(" Nenhum cliente ativo disponível para locação. ")),a(b,{to:"/clients/create",class:"text-blue-600 hover:text-blue-800 underline"},{default:n(()=>e[9]||(e[9]=[f(" Criar novo cliente ")])),_:1,__:[9]})])):y("",!0)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Data de Devolução *",-1)),a(G,{modelValue:c.returnDate,"onUpdate:modelValue":e[2]||(e[2]=s=>c.returnDate=s),type:"date",placeholder:"Selecione a data",format:"DD/MM/YYYY","value-format":"YYYY-MM-DD","disabled-date":R,class:"w-full"},null,8,["modelValue"]),i.returnDate?(o(),r("p",xe,u(i.returnDate),1)):y("",!0)])]),t("div",null,[t("div",be,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Filmes Selecionados",-1)),a(g,{type:"button",variant:"outline",onClick:e[3]||(e[3]=s=>M.value=!0),icon:"Plus"},{default:n(()=>e[12]||(e[12]=[f(" Adicionar Filme ")])),_:1,__:[12]})]),d.value.length===0?(o(),r("div",he,[a(p,{class:"h-12 w-12 text-gray-400 mx-auto mb-4"},{default:n(()=>[a(x(j))]),_:1}),e[14]||(e[14]=t("p",{class:"text-gray-500"},"Nenhum filme selecionado",-1)),e[15]||(e[15]=t("p",{class:"text-sm text-gray-400"},'Clique em "Adicionar Filme" para começar',-1))])):(o(),r("div",De,[(o(!0),r(k,null,q(d.value,s=>(o(),r("div",{key:s.imdbID,class:"relative bg-white border border-gray-200 rounded-lg p-4"},[t("button",{type:"button",onClick:H=>K(s.imdbID),class:"absolute top-2 right-2 text-gray-400 hover:text-red-600"},[a(p,{class:"h-5 w-5"},{default:n(()=>[a(x(A))]),_:1})],8,we),t("div",ke,[s.Poster&&s.Poster!=="N/A"?(o(),r("img",{key:0,src:s.Poster,alt:s.Title,class:"w-16 h-24 object-cover rounded"},null,8,Ie)):(o(),r("div",Ce,[a(p,{class:"h-8 w-8 text-gray-400"},{default:n(()=>[a(x(j))]),_:1})])),t("div",Se,[t("h4",$e,u(s.Title),1),t("p",Me,u(s.Year),1),t("p",Ve,u(s.imdbID),1)])])]))),128))])),i.movies?(o(),r("p",Ye,u(i.movies),1)):y("",!0)]),t("div",Ne,[a(g,{type:"button",variant:"outline",onClick:e[4]||(e[4]=s=>l.$router.push("/rentals"))},{default:n(()=>e[16]||(e[16]=[f(" Cancelar ")])),_:1,__:[16]}),a(g,{type:"submit",loading:$.value,disabled:d.value.length===0},{default:n(()=>e[17]||(e[17]=[f(" Criar Locação ")])),_:1,__:[17]},8,["loading","disabled"])])],32)]),_:1})]),M.value?(o(),r("div",Te,[t("div",qe,[t("div",je,[t("div",Ee,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Buscar Filmes",-1)),t("button",{onClick:e[5]||(e[5]=s=>M.value=!1),class:"text-gray-400 hover:text-gray-600"},[a(p,{class:"h-6 w-6"},{default:n(()=>[a(x(A))]),_:1})])]),t("div",Pe,[t("div",Ae,[t("div",Be,[a(ce,{modelValue:_.query,"onUpdate:modelValue":e[6]||(e[6]=s=>_.query=s),placeholder:"Digite o nome do filme...",onKeyup:ae(P,["enter"])},null,8,["modelValue"])]),a(g,{onClick:P,loading:w.value,icon:"Search"},{default:n(()=>e[19]||(e[19]=[f(" Buscar ")])),_:1,__:[19]},8,["loading"])])]),w.value?(o(),r("div",Fe,e[20]||(e[20]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-gray-500"},"Buscando filmes...",-1)]))):v.value.length===0&&_.hasSearched?(o(),r("div",Re,[a(p,{class:"h-16 w-16 text-gray-400 mx-auto mb-4"},{default:n(()=>[a(x(ie))]),_:1}),e[21]||(e[21]=t("p",{class:"text-gray-500"},"Nenhum filme encontrado",-1))])):v.value.length>0?(o(),r("div",Le,[(o(!0),r(k,null,q(v.value,s=>(o(),r("div",{key:s.imdbID,class:"border border-gray-200 rounded-lg p-3"},[t("div",Oe,[s.Poster&&s.Poster!=="N/A"?(o(),r("img",{key:0,src:s.Poster,alt:s.Title,class:"w-12 h-18 object-cover rounded"},null,8,ze)):(o(),r("div",Ke,[a(p,{class:"h-6 w-6 text-gray-400"},{default:n(()=>[a(x(j))]),_:1})])),t("div",Ue,[t("h4",Ge,u(s.Title),1),t("p",He,u(s.Year),1),a(g,{size:"small",variant:"primary",onClick:H=>z(s),disabled:Y(s.imdbID),class:"mt-2"},{default:n(()=>[f(u(Y(s.imdbID)?"Selecionado":"Adicionar"),1)]),_:2},1032,["onClick","disabled"])])])]))),128))])):y("",!0)])])])):y("",!0)],64)}}});export{Ze as default};
